{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Delivery Note | {{ entry.paper_number }}</title>
    <style>
        /* PDF Page Configuration */
        @page {
            size: A4;
            margin: 0;
            @bottom-right {
                content: "Delivery Ref: {{ entry.paper_number }} | Page " counter(page);
                font-size: 7px;
                color: #94a3b8;
                margin-right: 20mm;
                margin-bottom: 10mm;
            }
        }

        /* Base Styles */
        body {
            font-family: 'Inter', 'Helvetica', 'Arial', sans-serif;
            font-size: 11px;
            line-height: 1.6;
            color: #334155;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }

        .page-wrapper {
            width: 100%;
            background-color: #ffffff;
            min-height: 297mm;
            position: relative;
        }

        /* High-Visibility Identification Badge - Moved higher, background removed */
        .outside-id-badge {
            position: absolute;
            top: 5px; /* Moved slightly higher from 10px */
            right: 50px;
            background-color: transparent; /* "No color" as requested */
            color: #ffffff; /* White text as requested */
            padding: 10px 0; /* Adjusted padding for no background */
            font-weight: 800;
            font-size: 14px;
            z-index: 100;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: none; /* Removed shadow for the "no color" look */
        }

        /* Specific font for the ID number */
        .id-number {
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2em;
            margin-left: 5px;
            color: #ffffff; /* Explicitly white text for the number */
            padding: 2px 6px;
            border-radius: 2px;
        }

        /* Accent Elements */
        .accent-bar {
            height: 120px;
            background-color: #0f172a; /* Slate 900 */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1;
        }

        /* Content Layout */
        .content {
            position: relative;
            z-index: 2;
            padding: 40px 75px 40px 50px;
        }

        table { width: 100%; border-collapse: collapse; }
        .table-fixed { table-layout: fixed; }
        td { vertical-align: top; }

        /* Branding Header */
        .header-table { margin-bottom: 40px; color: #ffffff; }
        .logo { max-height: 65px; width: auto; border-radius: 4px; }
        .delivery-title {
            font-size: 42px;
            font-weight: 200;
            letter-spacing: 4px;
            margin: 0;
            text-transform: uppercase;
            text-align: right;
            color: #e11d48; /* Crimson Accent restored */
        }

        /* Info Grid */
        .info-grid {
            background-color: #ffffff;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 40px;
            border: 1px solid #e2e8f0;
        }
        .label { font-size: 8px; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; display: block; }
        .value { font-size: 11px; font-weight: 600; color: #0f172a; }

        /* Client & Company */
        .parties-section { margin-bottom: 50px; }
        .heading-small { 
            font-size: 10px; 
            font-weight: 800; 
            color: #e11d48; /* Crimson Accent restored */
            text-transform: uppercase; 
            margin-bottom: 12px; 
            border-left: 3px solid #e11d48; /* Crimson Accent restored */
            padding-left: 10px; 
        }

        /* Modern Table */
        .items-table { margin-bottom: 40px; }
        .items-table th {
            text-align: left;
            padding: 15px 10px;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            color: #64748b;
            border-bottom: 2px solid #f1f5f9;
        }
        .items-table td {
            padding: 15px 10px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }
        .item-number {
            display: inline-block;
            width: 22px;
            height: 22px;
            line-height: 22px;
            text-align: center;
            background-color: #f1f5f9;
            border-radius: 50%;
            font-size: 9px;
            font-weight: bold;
            color: #475569;
        }
        .product-name { font-weight: 700; font-size: 12px; color: #0f172a; display: block; }
        .product-desc { font-size: 9px; color: #64748b; margin-top: 4px; line-height: 1.4; }

        /* Logistics Acknowledgement */
        .acknowledgement-box {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin-bottom: 40px;
        }

        /* Footer Details */
        .footer-area { margin-top: 50px; font-size: 9px; color: #64748b; }
        .signature-box { border-bottom: 1px solid #e2e8f0; height: 50px; margin-bottom: 10px; }

        /* Browser Preview */
        .no-print {
            background: #e11d48; /* Crimson Accent restored */
            padding: 12px; 
            text-align: center;
            position: sticky; 
            top: 0; 
            z-index: 100;
        }
        .btn {
            color: #fff; text-decoration: none; font-weight: bold;
            border: 1px solid #fff; padding: 8px 24px; border-radius: 4px;
        }

        @media print {
            .no-print { display: none; }
            .page-wrapper { width: 100%; margin: 0; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <a href="{% url 'paper_pdf' entry.id 'delivery' %}" class="btn" target="_blank">
        GENERATE PDF DELIVERY NOTE
    </a>
</div>

<div class="page-wrapper">
    <!-- FLOATING ID BADGE (Now borderless, transparent, and white text) -->
    <div class="outside-id-badge">
        DL NO: <span class="id-number">{{ entry.paper_number }}</span>
    </div>

    <div class="accent-bar"></div>

    <div class="content">
        <!-- HEADER -->
        <table class="header-table">
            <tr>
                <td>
                    {% if entry.company.logo %}
                        <img src="{% if is_pdf %}file://{{ entry.company.logo.path }}{% else %}{{ entry.company.logo.url }}{% endif %}" class="logo">
                    {% else %}
                        <div style="font-size: 24px; font-weight: 800; letter-spacing: -1px;">{{ entry.company.name }}</div>
                    {% endif %}
                </td>
                <td>
                    <h1 class="delivery-title">DELIVERY NOTE</h1>
                </td>
            </tr>
        </table>

        <!-- INFO GRID -->
        <div class="info-grid">
            <table class="table-fixed">
                <tr>
                    <td>
                        <span class="label">Status</span>
                        <span class="value">Official Release</span>
                    </td>
                    <td>
                        <span class="label">Delivery Date</span>
                        <span class="value">{{ entry.date|date:"d F Y" }}</span>
                    </td>

                    <td class="text-right">
                        <span class="label">Vehicle/Driver</span>
                        <span class="value">________________</span>
                    </td>
                </tr>
            </table>
        </div>

        <!-- PARTIES -->
        <table class="parties-section table-fixed">
            <tr>
                <td style="padding-right: 50px;">
                    <div class="heading-small">From: Dispatch Point</div>
                    <div style="font-weight: bold; font-size: 13px; color: #0f172a;">{{ entry.company.name }}</div>
                    <div style="margin-top: 5px;">
                        {{ entry.company.address|linebreaksbr }}<br>
                        <span style="font-weight: bold;">T:</span> {{ entry.company.phone }}
                    </div>
                </td>
                <td>
                    <div class="heading-small">To: Delivery Address</div>
                    <div style="font-weight: bold; font-size: 13px; color: #0f172a;">{{ entry.client.name }}</div>
                    <div style="margin-top: 5px;">
                        {{ entry.client.address|default:"As per Customer Account"|linebreaksbr }}
                    </div>
                </td>
            </tr>
        </table>

        <!-- LINE ITEMS -->
        <table class="items-table">
            <thead>
                <tr>
                    <th width="45">Item</th>
                    <th>Description of Goods</th>
                    <th width="80" style="text-align: center;">Qty Order</th>
                    <th width="80" style="text-align: center;">Qty Deliv</th>
                    <th width="150">Condition / Remarks</th>
                </tr>
            </thead>
            <tbody>
                {% for item in entry.items.all %}
                <tr class="item-row">
                    <td><div class="item-number">{{ forloop.counter }}</div></td>
                    <td>
                        <span class="product-name">{{ item.product_name|default:item.description }}</span>
                        {% if item.product_name %}<div class="product-desc">{{ item.description }}</div>{% endif %}
                    </td>
                    <td style="text-align: center; font-weight: 700;">{{ item.quantity|floatformat:0 }}</td>
                    <td style="text-align: center; color: #cbd5e1;">_______</td>
                    <td class="product-desc">Checked [ ] Damage [ ]</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- ACKNOWLEDGEMENT -->
        <div class="acknowledgement-box">
            <div class="heading-small" style="border: none; padding: 0;">Confirmation of Receipt</div>
            <div style="font-size: 10px; color: #475569; margin-top: 8px;">
                I, the undersigned, hereby acknowledge that the goods listed above have been received in the quantities specified
                and are in good order and condition, subject to any remarks noted in the table above.
            </div>
        </div>

        <!-- FOOTER SIGNATURES -->
        <table class="table-fixed footer-area" style="margin-top: 30px;">
            <tr>
                <td style="padding-right: 40px;">
                    <div class="signature-box"></div>
                    <span class="label">Warehouse Release</span>
                    <div style="font-weight: bold; color: #0f172a;">Authorized Personnel</div>
                </td>
                <td style="padding-right: 40px;">
                    <div class="signature-box"></div>
                    <span class="label">Delivered By (Driver)</span>
                    <div style="font-weight: bold; color: #0f172a;">Name: ________________</div>
                </td>
                <td>
                    <div class="signature-box"></div>
                    <span class="label">Received By (Customer)</span>
                    <div style="font-weight: bold; color: #0f172a;">Sign & Stamp</div>
                </td>
            </tr>
        </table>

        <div style="margin-top: 40px; border-top: 1px solid #f1f5f9; padding-top: 15px; font-size: 8px; color: #94a3b8; text-align: center;">
            {{ entry.company.name }} | {{ entry.company.address }} | Delivery Time: ____ : ____
        </div>
    </div>
</div>

</body>
</html>