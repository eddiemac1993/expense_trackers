{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Invoice | {{ entry.company.name }}</title>

<style>
    /* PDF Page Configuration */
    @page {
        size: A4;
        margin: 20mm 15mm 20mm 15mm;
    }

    body {
        font-family: Calibri, Arial, sans-serif;
        font-size: 12.5px;
        color: #000;
        margin: 0;
        padding: 0;
        position: relative; /* Essential for absolute positioning of the badge */
    }

    .container {
        width: 100%;
        position: relative;
    }

    /* Formal "Outside Boundary" Identification Styling - No Border */
    .outside-id-badge {
        position: absolute;
        top: -45px;
        right: 0;
        font-size: 18px;
        font-weight: bold;
        color: #000;
        padding: 5px 0;
        background-color: #fff;
        z-index: 100;
        text-transform: uppercase;
    }

    /* Header */
    .header-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
    }
    .header-table td {
        vertical-align: top;
    }
    .company-name {
        font-size: 22px;
        font-weight: bold;
        text-transform: uppercase;
        line-height: 1;
    }
    .header-details {
        font-size: 11.5px;
        margin-top: 5px;
    }
    .logo img {
        max-height: 70px;
        float: right;
    }

    /* Titles */
    .section-title {
        font-weight: bold;
        font-size: 14px;
        margin: 20px 0 5px;
        border-bottom: 2px solid #000;
        padding-bottom: 3px;
        text-transform: uppercase;
    }

    /* Info table */
    .info-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
    }
    .info-table td {
        width: 50%;
        vertical-align: top;
        padding: 8px 4px;
    }

    /* Items */
    .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    .items-table th,
    .items-table td {
        border: 1px solid #000;
        padding: 8px 6px;
    }
    .items-table th {
        background: #f2f2f2;
        text-align: left;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 11px;
    }

    /* Totals */
    .totals-table {
        width: 45%;
        border-collapse: collapse;
        margin-top: 15px;
        float: right;
    }
    .totals-table td {
        border: 1px solid #000;
        padding: 8px;
    }

    /* Bank details */
    .bank-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    .bank-table td {
        border: 1px solid #000;
        padding: 8px 6px;
    }

    /* Signatures */
    .signature-table {
        width: 100%;
        margin-top: 80px;
        border-collapse: collapse;
        text-align: center;
    }
    .signature-table td {
        width: 33%;
        padding: 0 10px;
    }
    .signature-line {
        margin-top: 40px;
        border-top: 1px solid #000;
        padding-top: 5px;
        font-size: 11px;
        font-weight: bold;
    }

    .right { text-align: right; }

    .no-print {
        text-align: right;
        margin-bottom: 20px;
    }
    .no-print a {
        padding: 8px 16px;
        background: #0f2a44;
        color: #fff;
        text-decoration: none;
        font-weight: bold;
        font-size: 11px;
        border-radius: 2px;
    }

    @media print {
        .no-print { display: none; }
        .outside-id-badge { top: -45px; }
    }
</style>
</head>

<body>
<div class="container">

<div class="no-print">
    <a href="{% url 'paper_pdf' entry.id 'invoice' %}" target="_blank">
        DOWNLOAD PDF
    </a>
</div>

<!-- FORMAL FLOATING ID BADGE -->
<div class="outside-id-badge">
    INV NO: {{ entry.paper_number }}
</div>

<!-- HEADER -->
<table class="header-table">
<tr>
    <td>
        <div class="company-name">{{ entry.company.name }}</div>
        <div class="header-details">
            {{ entry.company.address|linebreaksbr }}<br>
        </div>
    </td>
    <td class="logo">
        {% if entry.company.logo %}
            {% if is_pdf %}
                <img src="file://{{ entry.company.logo.path }}">
            {% else %}
                <img src="{{ entry.company.logo.url }}">
            {% endif %}
        {% endif %}
    </td>
</tr>
</table>

<div class="section-title">INVOICE DETAILS</div>

<!-- INFO -->
<table class="info-table">
<tr>
    <td>
        <strong>Invoice No:</strong> {{ entry.paper_number }}<br>
        <strong>Invoice Date:</strong> {{ entry.date|date:"d M Y" }}
    </td>
    <td>
        <strong>Bill To:</strong><br>
        <span style="font-size: 14px; font-weight: bold;">{{ entry.client.name }}</span><br>
    </td>
</tr>
</table>

<!-- ITEMS -->
<table class="items-table">
<thead>
<tr>
    <th style="width:5%">#</th>
    <th>Description</th>
    <th style="width:10%" class="right">Qty</th>
    <th style="width:15%" class="right">Unit Rate</th>
    <th style="width:15%" class="right">Amount</th>
</tr>
</thead>
<tbody>
{% for item in entry.items.all %}
<tr>
    <td>{{ forloop.counter }}</td>
    <td>{{ item.description }}</td>
    <td class="right">{{ item.quantity|floatformat:2 }}</td>
    <td class="right">{{ item.unit_price|floatformat:2|intcomma }}</td>
    <td class="right">{{ item.amount|floatformat:2|intcomma }}</td>
</tr>
{% endfor %}
</tbody>
</table>

<!-- TOTALS -->
<table class="totals-table">
<tr>
    <td>SUBTOTAL (ZMW)</td>
    <td class="right">{{ entry.subtotal|floatformat:2|intcomma }}</td>
</tr>
<tr>
    <td>TAX ({{ entry.tax_percentage }}%)</td>
    <td class="right">{{ entry.tax_amount|floatformat:2|intcomma }}</td>
</tr>
<tr>
    <td><strong>GRAND TOTAL (ZMW)</strong></td>
    <td class="right"><strong>{{ entry.total|floatformat:2|intcomma }}</strong></td>
</tr>
</table>

<div style="clear: both;"></div>

<!-- BANK DETAILS -->
<div class="section-title">BANK DETAILS</div>

<table class="bank-table">
<tr>
    <td width="30%"><strong>Bank Name</strong></td>
    <td>Indo Zambia Bank </td>
</tr>
<tr>
    <td><strong>Account Name</strong></td>
    <td>THE CMM CHRONOS LIMITED</td>
</tr>
<tr>
    <td><strong>Account Number</strong></td>
    <td>0142030000857</td>
</tr>
<tr>
    <td><strong>Branch</strong></td>
    <td>Manda Hill </td>
</tr>
<tr>
    <td><strong>Swift Code</strong></td>
    <td>INZAZMLX</td>
</tr>
</table>

<!-- SIGNATURE -->
<table class="signature-table">
<tr>
    <td><div class="signature-line">Prepared By</div></td>
    <td><div class="signature-line">Authorized Signature</div></td>
    <td><div class="signature-line">Date</div></td>
</tr>
</table>

</div>
</body>
</html>