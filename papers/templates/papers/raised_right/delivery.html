{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Delivery Note | {{ entry.paper_number }}</title>
    <style>
        /* PDF Page Configuration */
        @page {
            size: A4;
            margin: 15mm 15mm 20mm 15mm;
            @bottom-center {
                content: "Please check all goods upon delivery.";
                font-size: 8px;
                color: #999;
            }
        }

        /* Base Styles */
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11px;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container { width: 100%; }

        /* Helpers */
        .bold { font-weight: bold; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .text-muted { color: #777; }
        .uppercase { text-transform: uppercase; }

        /* Table Layouts */
        table { width: 100%; border-collapse: collapse; }
        .table-fixed { table-layout: fixed; }
        td { vertical-align: top; }

        /* Header Branding */
        .header-table { margin-bottom: 30px; }
        .logo { max-height: 80px; width: auto; }
        .company-title { font-size: 28px; margin: 0; color: #000; letter-spacing: -1px; }

        /* Document Title Bar */
        .doc-title-bar {
            background-color: #f8f9fa;
            padding: 10px;
            border-top: 2px solid #333;
            border-bottom: 1px solid #ddd;
            margin-bottom: 25px;
        }

        /* Meta Info Boxes */
        .meta-label { font-size: 9px; color: #888; text-transform: uppercase; display: block; }
        .meta-value { font-size: 11px; font-weight: bold; }

        /* Client Info */
        .client-info { margin-bottom: 35px; }
        .section-header {
            font-size: 10px;
            text-transform: uppercase;
            color: #888;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        /* Items Table */
        .items-table { margin-bottom: 30px; }
        .items-table th {
            background-color: #333;
            color: #fff;
            padding: 8px 10px;
            text-align: left;
            font-size: 10px;
            text-transform: uppercase;
        }
        .items-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
        }
        .items-table tr:last-child td { border-bottom: 2px solid #333; }

        /* Delivery Specifics */
        .delivery-notes {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #ddd;
            font-size: 10px;
        }

        /* Footer & Signatures */
        .footer-details { margin-top: 50px; font-size: 10px; }
        .signature-space { border-top: 1px solid #333; width: 90%; margin-top: 45px; padding-top: 5px; }

        /* Interactive Elements */
        .no-print {
            background: #222; padding: 12px; text-align: center;
            position: sticky; top: 0; z-index: 100;
        }
        .btn-download {
            color: #fff; text-decoration: none; font-weight: bold;
            border: 1px solid #fff; padding: 6px 15px; border-radius: 3px;
            font-size: 10px;
        }

        @media print {
            .no-print { display: none; }
        }
    </style>
</head>
<body>

<!-- Browser-only Navigation -->
<div class="no-print">
    <a href="{% url 'paper_pdf' entry.id 'delivery' %}" class="btn-download" target="_blank">
        PREVIEW AS PDF
    </a>
</div>

<div class="container">

    <!-- HEADER -->
    <table class="header-table">
        <tr>
            <td width="50%">
                {% if entry.company.logo %}
                    <img src="{% if is_pdf %}file://{{ entry.company.logo.path }}{% else %}{{ entry.company.logo.url }}{% endif %}" class="logo">
                {% endif %}
            </td>
            <td width="50%" class="text-right">
                <h1 class="company-title">DELIVERY NOTE</h1>
                <div class="text-muted">
                    <span class="bold">{{ entry.company.name }}</span><br>
                    {{ entry.company.address|linebreaksbr }}<br>
                </div>
            </td>
        </tr>
    </table>

    <!-- META DATA -->
    <div class="doc-title-bar">
        <table class="table-fixed">
            <tr>
                <td>
                    <span class="meta-label">Delivery Note No.</span>
                    <span class="meta-value">{{ entry.paper_number }}</span>
                </td>
                <td>
                    <span class="meta-label">Delivery Date</span>
                    <span class="meta-value">{{ entry.date|date:"d M Y" }}</span>
                </td>
                <td>
                    <span class="meta-label">Reference / P.O.</span>
                    <span class="meta-value">{{ entry.reference_number|default:"N/A" }}</span>
                </td>
                <td class="text-right">
                    <span class="meta-label">Status</span>
                    <span class="meta-value uppercase">Pending Confirmation</span>
                </td>
            </tr>
        </table>
    </div>

    <!-- CLIENT INFO -->
    <div class="client-info">
        <table class="table-fixed">
            <tr>
                <td width="50%">
                    <div class="section-header">Delivery To:</div>
                    <div style="font-size: 13px;">
                        <span class="bold">{{ entry.client.name }}</span><br>
                        {{ entry.client.address|default:""|linebreaksbr }}
                    </div>
                </td>
                <td width="50%" class="text-right">
                    <div class="section-header">Transport Details:</div>
                    <div class="text-muted">
                        Driver: __________________________<br>
                        Reg No: __________________________
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- LINE ITEMS -->
    <table class="items-table">
        <thead>
            <tr>
                <th width="40">#</th>
                <th>Description of Goods</th>
                <th width="80" class="text-center">Qty Ordered</th>
                <th width="80" class="text-center">Qty Delivered</th>
                <th width="120">Condition / Remarks</th>
            </tr>
        </thead>
        <tbody>
            {% for item in entry.items.all %}
            <tr>
                <td class="text-muted">{{ forloop.counter }}</td>
                <td>
                    <span class="bold">{{ item.product_name|default:item.description }}</span>
                    {% if item.product_name %}<br><span class="text-muted" style="font-size: 9px;">{{ item.description }}</span>{% endif %}
                </td>
                <td class="text-center">{{ item.quantity|floatformat:0 }}</td>
                <td class="text-center">_______</td>
                <td class="text-muted" style="font-size: 9px;"></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- TERMS & ACKNOWLEDGEMENT -->
    <div class="delivery-notes">
        <span class="bold uppercase">Confirmation of Receipt:</span><br>
        I, the undersigned, hereby acknowledge that the goods listed above have been received in good condition and correct quantity,
        subject to any remarks noted in the table above.
    </div>

    <!-- SIGNATURES -->
    <div class="footer-details">
        <table class="table-fixed">
            <tr>
                <td width="33%">
                    <div class="signature-space">
                        <span class="bold">Released By</span><br>
                        <span class="text-muted uppercase" style="font-size: 8px;">For {{ entry.company.name }}</span>
                    </div>
                </td>
                <td width="33%">
                    <div class="signature-space" style="margin: 0 auto;">
                        <span class="bold">Delivered By</span><br>
                        <span class="text-muted uppercase" style="font-size: 8px;">Driver's Signature</span>
                    </div>
                </td>
                <td width="33%">
                    <div class="signature-space" style="margin-left: auto;">
                        <span class="bold">Received By</span><br>
                        <span class="text-muted uppercase" style="font-size: 8px;">Customer Signature & Stamp</span>
                    </div>
                </td>
            </tr>
        </table>
        <div style="margin-top: 20px; font-size: 9px; color: #999;" class="text-center">
            Date: ____/____/20____ &nbsp;&nbsp;&nbsp;&nbsp; Time: ____:____
        </div>
    </div>

</div>

</body>
</html>